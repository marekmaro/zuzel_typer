<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typer Ekstraliga 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #003366; --accent: #ffcc00; --bg: #f4f4f9; --text: #333; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; }
        
        /* Header */
        header { background: linear-gradient(135deg, var(--primary), #004080); color: var(--white); padding: 20px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        h1 { margin: 0; font-size: 1.8rem; letter-spacing: 1px; }
        .subtitle { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }

        .container { max-width: 1000px; margin: 20px auto; padding: 0 15px; }

        /* Menu */
        .nav-bar { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .nav-btn { background: var(--white); border: 2px solid transparent; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; color: var(--primary); transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav-btn:hover { background: #eef; }
        .nav-btn.active { background: var(--primary); color: var(--white); border-color: var(--primary); }
        .nav-btn.admin-mode { background: #d32f2f; color: white; }

        /* Sekcje */
        .section { display: none; background: var(--white); padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .section.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #eee; color: #555; padding: 12px; font-size: 0.85rem; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        .rank-1 { background-color: #fffde7; border-left: 5px solid var(--accent); }
        .points-total { font-weight: bold; color: var(--primary); font-size: 1.1rem; }

        /* Mecze */
        .match-card { border: 1px solid #f0f0f0; border-radius: 8px; margin-bottom: 15px; background: #fafafa; }
        .match-header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; background: #fff; border-radius: 8px 8px 0 0; }
        .match-date { font-size: 0.8rem; color: #888; }
        .match-teams { font-weight: 700; color: #333; }
        .match-score { font-size: 1.2rem; font-weight: bold; color: var(--primary); background: #e3f2fd; padding: 5px 12px; border-radius: 6px; }
        
        .types-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; padding: 15px; }
        .type-box { background: #fff; padding: 8px; border: 1px solid #eee; border-radius: 6px; font-size: 0.9rem; position: relative; }
        .joker-badge { position: absolute; top: -5px; right: -5px; background: var(--accent); color: #000; font-size: 0.65rem; padding: 2px 6px; border-radius: 10px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        .pts-badge { display: inline-block; width: 22px; height: 22px; line-height: 22px; text-align: center; border-radius: 50%; color: white; font-size: 0.75rem; margin-left: 5px; font-weight: bold; }
        .p-5 { background: #2e7d32; } .p-3 { background: #1565c0; } .p-2 { background: #ef6c00; } .p-0 { background: #c62828; }

        /* Admin Panel */
        .admin-controls { margin-top: 20px; border-top: 2px solid #eee; padding-top: 20px; }
        .form-row { margin-bottom: 15px; }
        input[type="text"], select { padding: 8px; width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button.action-btn { padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-green { background: #4caf50; color: white; }
        .btn-blue { background: #2196f3; color: white; }
        .btn-red { background: #f44336; color: white; }
        
        .copy-area { width: 100%; height: 100px; font-family: monospace; font-size: 0.8rem; margin-top: 10px; }

    </style>
</head>
<body>

<header>
    <h1> Typer Ekstraliga 2026</h1>
    <div class="subtitle">Oficjalna liga typer贸w</div>
</header>

<div class="container">
    
    <div class="nav-bar">
        <button class="nav-btn active" onclick="app.showTab('ranking')">Tabela</button>
        <button class="nav-btn" onclick="app.showTab('matches')">Mecze</button>
        <button class="nav-btn" onclick="app.showTab('stats')">Wykres</button>
        <button class="nav-btn" onclick="app.showTab('rules')">Regulamin</button>
        <button class="nav-btn admin-mode" onclick="app.toggleAdmin()">ADMIN</button>
    </div>

    <!-- TABELA -->
    <div id="ranking" class="section active">
        <h2>Klasyfikacja Generalna</h2>
        <table id="rankTable">
            <thead>
                <tr>
                    <th>Poz</th>
                    <th style="text-align:left">Gracz</th>
                    <th>5 pkt</th>
                    <th>3 pkt</th>
                    <th>2 pkt</th>
                    <th>Suma</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- MECZE -->
    <div id="matches" class="section">
        <div style="text-align:center; margin-bottom:20px;">
            <select id="roundSelect" onchange="app.renderMatches()" style="padding:10px; font-size:1rem; max-width:300px;"></select>
        </div>
        <div id="matchesContainer"></div>
    </div>

    <!-- WYKRES -->
    <div id="stats" class="section">
        <canvas id="chartCtx"></canvas>
    </div>

    <!-- REGULAMIN -->
    <div id="rules" class="section">
        <h3>Zasady Gry</h3>
        <ul style="line-height:1.6">
            <li><strong>Typowanie:</strong> Do 24h przed meczem.</li>
            <li><strong>Punktacja:</strong> 
                <span class="pts-badge p-5">5</span> Dokadny wynik, 
                <span class="pts-badge p-3">3</span> Zwycizca + r贸偶nica pkt, 
                <span class="pts-badge p-2">2</span> Zwycizca.
            </li>
            <li><strong>JOKER (x2):</strong> Raz na rund przy jednym meczu.</li>
            <li><strong>Walkower:</strong> 40:0.</li>
        </ul>
    </div>

    <!-- PANEL ADMINA -->
    <div id="adminPanel" class="section" style="border: 2px solid #d32f2f;">
        <h2 style="color:#d32f2f">锔 Panel Administratora</h2>
        <p>1. Wprowad藕 wyniki lub typy.<br>2. Kliknij "POBIERZ NOW BAZ".<br>3. Skopiuj kod i podmie go w pliku index.html w sekcji "DANE STARTOWE".</p>
        
        <div class="admin-controls">
            <h3>Edycja Mecz贸w</h3>
            <div class="form-row">
                <label>Wybierz mecz:</label>
                <select id="adminMatchSelect"></select>
            </div>
            
            <div style="background:#eee; padding:15px; border-radius:5px;">
                <h4>Wynik Oficjalny</h4>
                <input type="text" id="adminResult" placeholder="np. 50:40">
                <button class="action-btn btn-green" onclick="admin.saveResult()">Zapisz Wynik</button>
            </div>

            <div style="background:#eee; padding:15px; border-radius:5px; margin-top:10px;">
                <h4>Dodaj Typ Gracza</h4>
                <select id="adminPlayerSelect"></select>
                <input type="text" id="adminTipScore" placeholder="np. 48:42" style="margin-top:5px;">
                <label><input type="checkbox" id="adminTipJoker"> JOKER (x2)</label>
                <button class="action-btn btn-blue" onclick="admin.saveTip()" style="margin-top:5px;">Zapisz Typ</button>
            </div>
        </div>

        <div style="margin-top:30px; border-top:2px dashed #ccc; padding-top:20px;">
            <h3> Eksport Danych na GitHub</h3>
            <button class="action-btn btn-red" onclick="admin.exportData()">POBIERZ NOW BAZ (JSON)</button>
            <textarea id="exportArea" class="copy-area" placeholder="Tutaj pojawi si kod do skopiowania..."></textarea>
        </div>
    </div>

</div>

<script>
/* ==========================================================================
   DANE STARTOWE (TO PODMIENIASZ JAKO ADMIN PO POBRANIU Z PANELU)
   ========================================================================== */
const initialData = {
  "players": [
    {"id": "p1", "name": "Marek"},
    {"id": "p2", "name": "Ania"},
    {"id": "p3", "name": "Tomek"}
  ],
  "schedule": [
    {
      "name": "1. Runda (10-12.04)",
      "matches": [
        {"host": "Bayersystem GKM Grudzidz", "guest": "Gezet Stal Gorz贸w", "date": "10-12.04", "result": null, "tips": {}},
        {"host": "Fogo Unia Leszno", "guest": "Krono-Plast W贸kniarz Czstochowa", "date": "10-12.04", "result": null, "tips": {}},
        {"host": "Orlen Oil Motor Lublin", "guest": "Pres Grupa Deweloperska Toru", "date": "10-12.04", "result": null, "tips": {}},
        {"host": "Betard Sparta Wrocaw", "guest": "Stelmet Falubaz Zielona G贸ra", "date": "10-12.04", "result": null, "tips": {}}
      ]
    },
    {
      "name": "2. Runda (17-19.04)",
      "matches": [
        {"host": "Krono-Plast W贸kniarz Czstochowa", "guest": "Orlen Oil Motor Lublin", "date": "17-19.04", "result": null, "tips": {}},
        {"host": "Gezet Stal Gorz贸w", "guest": "Betard Sparta Wrocaw", "date": "17-19.04", "result": null, "tips": {}},
        {"host": "Pres Grupa Deweloperska Toru", "guest": "Fogo Unia Leszno", "date": "17-19.04", "result": null, "tips": {}},
        {"host": "Stelmet Falubaz Zielona G贸ra", "guest": "Bayersystem GKM Grudzidz", "date": "17-19.04", "result": null, "tips": {}}
      ]
    },
    {
      "name": "3. Runda (24-26.04)",
      "matches": [
        {"host": "Krono-Plast W贸kniarz Czstochowa", "guest": "Pres Grupa Deweloperska Toru", "date": "24-26.04", "result": null, "tips": {}},
        {"host": "Bayersystem GKM Grudzidz", "guest": "Betard Sparta Wrocaw", "date": "24-26.04", "result": null, "tips": {}},
        {"host": "Fogo Unia Leszno", "guest": "Gezet Stal Gorz贸w", "date": "24-26.04", "result": null, "tips": {}},
        {"host": "Orlen Oil Motor Lublin", "guest": "Stelmet Falubaz Zielona G贸ra", "date": "24-26.04", "result": null, "tips": {}}
      ]
    },
    {
      "name": "4. Runda (3, 24.05)",
      "matches": [
        {"host": "Pres Grupa Deweloperska Toru", "guest": "Bayersystem GKM Grudzidz", "date": "03/24.05", "result": null, "tips": {}},
        {"host": "Betard Sparta Wrocaw", "guest": "Fogo Unia Leszno", "date": "03/24.05", "result": null, "tips": {}},
        {"host": "Gezet Stal Gorz贸w", "guest": "Orlen Oil Motor Lublin", "date": "03/24.05", "result": null, "tips": {}},
        {"host": "Stelmet Falubaz Zielona G贸ra", "guest": "Krono-Plast W贸kniarz Czstochowa", "date": "03/24.05", "result": null, "tips": {}}
      ]
    },
    {
      "name": "5. Runda (8-10.05)",
      "matches": [
        {"host": "Krono-Plast W贸kniarz Czstochowa", "guest": "Gezet Stal Gorz贸w", "date": "08-10.05", "result": null, "tips": {}},
        {"host": "Bayersystem GKM Grudzidz", "guest": "Fogo Unia Leszno", "date": "08-10.05", "result": null, "tips": {}},
        {"host": "Orlen Oil Motor Lublin", "guest": "Betard Sparta Wrocaw", "date": "08-10.05", "result": null, "tips": {}},
        {"host": "Pres Grupa Deweloperska Toru", "guest": "Stelmet Falubaz Zielona G贸ra", "date": "08-10.05", "result": null, "tips": {}}
      ]
    },
    {
      "name": "6. Runda (15-17.05)",
      "matches": [
        {"host": "Gezet Stal Gorz贸w", "guest": "Stelmet Falubaz Zielona G贸ra", "date": "15-17.05", "result": null, "tips": {}},
        {"host": "Bayersystem GKM Grudzidz", "guest": "Krono-Plast W贸kniarz Czstochowa", "date": "15-17.05", "result": null, "tips": {}},
        {"host": "Fogo Unia Leszno", "guest": "Orlen Oil Motor Lublin", "date": "15-17.05", "result": null, "tips": {}},
        {"host": "Betard Sparta Wrocaw", "guest": "Pres Grupa Deweloperska Toru", "date": "15-17.05", "result": null, "tips": {}}
      ]
    },
    {
      "name": "7. Runda (29-31.05)",
      "matches": [
        {"host": "Krono-Plast W贸kniarz Czstochowa", "guest": "Betard Sparta Wrocaw", "date": "29-31.05", "result": null, "tips": {}},
        {"host": "Orlen Oil Motor Lublin", "guest": "Bayersystem GKM Grudzidz", "date": "29-31.05", "result": null, "tips": {}},
        {"host": "Pres Grupa Deweloperska Toru", "guest": "Gezet Stal Gorz贸w", "date": "29-31.05", "result": null, "tips": {}},
        {"host": "Stelmet Falubaz Zielona G贸ra", "guest": "Fogo Unia Leszno", "date": "29-31.05", "result": null, "tips": {}}
      ]
    },
    {
      "name": "8. Runda (12-14.06)",
      "matches": [
        {"host": "Bayersystem GKM Grudzidz", "guest": "Stelmet Falubaz Zielona G贸ra", "date": "12-14.06", "result": null, "tips": {}},
        {"host": "Fogo Unia Leszno", "guest": "Pres Grupa Deweloperska Toru", "date": "12-14.06", "result": null, "tips": {}},
        {"host": "Orlen Oil Motor Lublin", "guest": "Krono-Plast W贸kniarz Czstochowa", "date": "12-14.06", "result": null, "tips": {}},
        {"host": "Betard Sparta Wrocaw", "guest": "Gezet Stal Gorz贸w", "date": "12-14.06", "result": null, "tips": {}}
      ]
    },
    {
      "name": "9. Runda (19-21.06)",
      "matches": [
        {"host": "Krono-Plast W贸kniarz Czstochowa", "guest": "Fogo Unia Leszno", "date": "19-21.06", "result": null, "tips": {}},
        {"host": "Gezet Stal Gorz贸w", "guest": "Bayersystem GKM Grudzidz", "date": "19-21.06", "result": null, "tips": {}},
        {"host": "Pres Grupa Deweloperska Toru", "guest": "Orlen Oil Motor Lublin", "date": "19-21.06", "result": null, "tips": {}},
        {"host": "Stelmet Falubaz Zielona G贸ra", "guest": "Betard Sparta Wrocaw", "date": "19-21.06", "result": null, "tips": {}}
      ]
    },
    {
      "name": "10. Runda (26-28.06)",
      "matches": [
        {"host": "Gezet Stal Gorz贸w", "guest": "Fogo Unia Leszno", "date": "26-28.06", "result": null, "tips": {}},
        {"host": "Pres Grupa Deweloperska Toru", "guest": "Krono-Plast W贸kniarz Czstochowa", "date": "26-28.06", "result": null, "tips": {}},
        {"host": "Betard Sparta Wrocaw", "guest": "Bayersystem GKM Grudzidz", "date": "26-28.06", "result": null, "tips": {}},
        {"host": "Stelmet Falubaz Zielona G贸ra", "guest": "Orlen Oil Motor Lublin", "date": "26-28.06", "result": null, "tips": {}}
      ]
    },
    {
      "name": "11. Runda (3-5.07)",
      "matches": [
        {"host": "Krono-Plast W贸kniarz Czstochowa", "guest": "Stelmet Falubaz Zielona G贸ra", "date": "03-05.07", "result": null, "tips": {}},
        {"host": "Bayersystem GKM Grudzidz", "guest": "Pres Grupa Deweloperska Toru", "date": "03-05.07", "result": null, "tips": {}},
        {"host": "Fogo Unia Leszno", "guest": "Betard Sparta Wrocaw", "date": "03-05.07", "result": null, "tips": {}},
        {"host": "Orlen Oil Motor Lublin", "guest": "Gezet Stal Gorz贸w", "date": "03-05.07", "result": null, "tips": {}}
      ]
    },
    {
      "name": "12. Runda (2, 9.08)",
      "matches": [
        {"host": "Gezet Stal Gorz贸w", "guest": "Krono-Plast W贸kniarz Czstochowa", "date": "02/09.08", "result": null, "tips": {}},
        {"host": "Fogo Unia Leszno", "guest": "Bayersystem GKM Grudzidz", "date": "02/09.08", "result": null, "tips": {}},
        {"host": "Betard Sparta Wrocaw", "guest": "Orlen Oil Motor Lublin", "date": "02/09.08", "result": null, "tips": {}},
        {"host": "Stelmet Falubaz Zielona G贸ra", "guest": "Pres Grupa Deweloperska Toru", "date": "02/09.08", "result": null, "tips": {}}
      ]
    },
    {
      "name": "13. Runda (14-16.08)",
      "matches": [
        {"host": "Krono-Plast W贸kniarz Czstochowa", "guest": "Bayersystem GKM Grudzidz", "date": "14-16.08", "result": null, "tips": {}},
        {"host": "Orlen Oil Motor Lublin", "guest": "Fogo Unia Leszno", "date": "14-16.08", "result": null, "tips": {}},
        {"host": "Pres Grupa Deweloperska Toru", "guest": "Betard Sparta Wrocaw", "date": "14-16.08", "result": null, "tips": {}},
        {"host": "Stelmet Falubaz Zielona G贸ra", "guest": "Gezet Stal Gorz贸w", "date": "14-16.08", "result": null, "tips": {}}
      ]
    },
    {
      "name": "14. Runda (21-23.08)",
      "matches": [
        {"host": "Gezet Stal Gorz贸w", "guest": "Pres Grupa Deweloperska Toru", "date": "21-23.08", "result": null, "tips": {}},
        {"host": "Bayersystem GKM Grudzidz", "guest": "Orlen Oil Motor Lublin", "date": "21-23.08", "result": null, "tips": {}},
        {"host": "Fogo Unia Leszno", "guest": "Stelmet Falubaz Zielona G贸ra", "date": "21-23.08", "result": null, "tips": {}},
        {"host": "Betard Sparta Wrocaw", "guest": "Krono-Plast W贸kniarz Czstochowa", "date": "21-23.08", "result": null, "tips": {}}
      ]
    },
    {
      "name": "15. Runda (Play-off/down)",
      "matches": [
        {"host": "P贸fina 1", "guest": "TBD", "date": "06.09", "result": null, "tips": {}},
        {"host": "P贸fina 2", "guest": "TBD", "date": "06.09", "result": null, "tips": {}},
        {"host": "Mecz o 5-6 msc (1)", "guest": "TBD", "date": "30.08", "result": null, "tips": {}},
        {"host": "Mecz o 5-6 msc (2)", "guest": "TBD", "date": "30.08", "result": null, "tips": {}}
      ]
    },
    {
      "name": "16. Runda (Rewan偶e 1)",
      "matches": [
        {"host": "P贸fina 1 (Rewan偶)", "guest": "TBD", "date": "13.09", "result": null, "tips": {}},
        {"host": "P贸fina 2 (Rewan偶)", "guest": "TBD", "date": "13.09", "result": null, "tips": {}},
        {"host": "Mecz o 5-6 msc (1R)", "guest": "TBD", "date": "04.09", "result": null, "tips": {}},
        {"host": "Mecz o 5-6 msc (2R)", "guest": "TBD", "date": "04.09", "result": null, "tips": {}}
      ]
    },
    {
      "name": "17. Runda (Finay 1)",
      "matches": [
        {"host": "FINA", "guest": "TBD", "date": "20.09", "result": null, "tips": {}},
        {"host": "Mecz o 3. miejsce", "guest": "TBD", "date": "20.09", "result": null, "tips": {}},
        {"host": "Mecz o 7. miejsce", "guest": "TBD", "date": "13.09", "result": null, "tips": {}}
      ]
    },
    {
      "name": "18. Runda (Finay 2)",
      "matches": [
        {"host": "FINA (Rewan偶)", "guest": "TBD", "date": "27.09", "result": null, "tips": {}},
        {"host": "Mecz o 3. miejsce (Rewan偶)", "guest": "TBD", "date": "27.09", "result": null, "tips": {}},
        {"host": "Mecz o 7. miejsce (Rewan偶)", "guest": "TBD", "date": "18.09", "result": null, "tips": {}}
      ]
    }
  ]
};
/* KONIEC DANYCH STARTOWYCH */


const app = {
    data: null,
    stats: {},

    init: function() {
        // adowanie danych
        this.data = initialData;
        
        // Dodaj swoich graczy tutaj jeli ich nie ma w initialData
        // Albo edytuj initialData na g贸rze!

        this.calculate();
        this.renderRanking();
        this.renderRoundSelect();
        this.renderMatches();
        this.renderChart();
        this.renderAdminSelects();
    },

    parseScore: function(str) {
        if (!str || !str.includes(':')) return null;
        const p = str.split(':');
        return { h: parseInt(p[0]), g: parseInt(p[1]) };
    },

    calcPoints: function(realStr, tipStr, isJoker) {
        if (!realStr || !tipStr) return 0;
        const r = this.parseScore(realStr);
        const t = this.parseScore(tipStr);
        if (!r || !t) return 0;

        let pts = 0;
        const rDiff = r.h - r.g;
        const tDiff = t.h - t.g;
        const rWin = rDiff > 0 ? 1 : (rDiff < 0 ? 2 : 0);
        const tWin = tDiff > 0 ? 1 : (tDiff < 0 ? 2 : 0);

        if (r.h === t.h && r.g === t.g) pts = 5;
        else if (rWin === tWin && rDiff === tDiff) pts = 3;
        else if (rWin === tWin) pts = 2;

        return isJoker ? pts * 2 : pts;
    },

    calculate: function() {
        this.stats = {};
        this.data.players.forEach(p => {
            this.stats[p.id] = { name: p.name, total: 0, p5:0, p3:0, p2:0, history: [] };
        });

        let cumulative = {};
        this.data.players.forEach(p => cumulative[p.id] = 0);

        this.data.schedule.forEach(round => {
            let roundPts = {};
            this.data.players.forEach(p => roundPts[p.id] = 0);

            round.matches.forEach(m => {
                if(m.result) {
                    this.data.players.forEach(p => {
                        const tip = m.tips[p.id];
                        if(tip) {
                            const pts = this.calcPoints(m.result, tip.score, tip.joker);
                            const basePts = tip.joker ? pts/2 : pts;
                            
                            this.stats[p.id].total += pts;
                            roundPts[p.id] += pts;
                            
                            if(basePts === 5) this.stats[p.id].p5++;
                            else if(basePts === 3) this.stats[p.id].p3++;
                            else if(basePts === 2) this.stats[p.id].p2++;
                        }
                    });
                }
            });

            this.data.players.forEach(p => {
                cumulative[p.id] += roundPts[p.id];
                this.stats[p.id].history.push(cumulative[p.id]);
            });
        });
    },

    renderRanking: function() {
        const tbody = document.querySelector("#rankTable tbody");
        const sorted = Object.values(this.stats).sort((a,b) => b.total - a.total);
        
        tbody.innerHTML = sorted.map((s, i) => `
            <tr class="${i===0 ? 'rank-1' : ''}">
                <td>${i+1}.</td>
                <td style="text-align:left; font-weight:bold;">${s.name} ${i===0?'':''}</td>
                <td>${s.p5}</td>
                <td>${s.p3}</td>
                <td>${s.p2}</td>
                <td><span class="points-total">${s.total}</span></td>
            </tr>
        `).join('');
    },

    renderRoundSelect: function() {
        const sel = document.getElementById("roundSelect");
        sel.innerHTML = this.data.schedule.map((r, i) => `<option value="${i}">${r.name}</option>`).join('');
    },

    renderMatches: function() {
        const rIdx = document.getElementById("roundSelect").value || 0;
        const round = this.data.schedule[rIdx];
        const container = document.getElementById("matchesContainer");

        container.innerHTML = round.matches.map(m => {
            const resHtml = m.result ? `<span class="match-score">${m.result}</span>` : `<span style="color:#ccc; font-weight:bold;">--:--</span>`;
            
            const tipsHtml = this.data.players.map(p => {
                const tip = m.tips[p.id];
                if(!tip) return '';
                
                const pts = m.result ? this.calcPoints(m.result, tip.score, tip.joker) : null;
                const ptsBadge = pts !== null ? `<span class="pts-badge p-${tip.joker ? pts/2 : pts}">${pts}</span>` : '';
                const jokerBadge = tip.joker ? `<span class="joker-badge">JOKER</span>` : '';

                return `<div class="type-box">
                    <div style="font-size:0.8rem; color:#666;">${p.name}</div>
                    <strong>${tip.score}</strong> ${jokerBadge} ${ptsBadge}
                </div>`;
            }).join('');

            return `
            <div class="match-card">
                <div class="match-header">
                    <div>
                        <div class="match-date">${m.date}</div>
                        <div class="match-teams">${m.host} - ${m.guest}</div>
                    </div>
                    ${resHtml}
                </div>
                <div class="types-container">
                    ${tipsHtml}
                </div>
            </div>`;
        }).join('');
    },

    renderChart: function() {
        const ctx = document.getElementById('chartCtx').getContext('2d');
        const datasets = this.data.players.map((p, i) => {
            const colors = ['#003366', '#d32f2f', '#fbc02d', '#388e3c', '#7b1fa2'];
            return {
                label: p.name,
                data: this.stats[p.id].history,
                borderColor: colors[i % colors.length],
                fill: false,
                tension: 0.1
            };
        });

        if(window.myChart) window.myChart.destroy();
        window.myChart = new Chart(ctx, {
            type: 'line',
            data: { labels: this.data.schedule.map(r => r.name), datasets: datasets },
            options: { responsive: true }
        });
    },

    renderAdminSelects: function() {
        const matchSel = document.getElementById("adminMatchSelect");
        matchSel.innerHTML = "";
        this.data.schedule.forEach((round, rIdx) => {
            round.matches.forEach((match, mIdx) => {
                const opt = document.createElement("option");
                opt.value = `${rIdx}|${mIdx}`;
                opt.text = `${round.name}: ${match.host} vs ${match.guest}`;
                matchSel.appendChild(opt);
            });
        });

        const playerSel = document.getElementById("adminPlayerSelect");
        playerSel.innerHTML = this.data.players.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    },

    showTab: function(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    },

    toggleAdmin: function() {
        const panel = document.getElementById('adminPanel');
        panel.classList.toggle('active');
        if(panel.classList.contains('active')) {
            const pass = prompt("Podaj haso administratora:");
            if(pass !== "zuzel2026") { // HASO
                alert("Bdne haso!");
                panel.classList.remove('active');
            }
        }
    }
};

const admin = {
    saveResult: function() {
        const [rIdx, mIdx] = document.getElementById("adminMatchSelect").value.split('|');
        const val = document.getElementById("adminResult").value;
        app.data.schedule[rIdx].matches[mIdx].result = val ? val : null;
        alert("Zapisano wynik. Pamitaj o EKSPORCIE!");
        app.init();
    },

    saveTip: function() {
        const [rIdx, mIdx] = document.getElementById("adminMatchSelect").value.split('|');
        const pId = document.getElementById("adminPlayerSelect").value;
        const score = document.getElementById("adminTipScore").value;
        const joker = document.getElementById("adminTipJoker").checked;

        if(!score) return;

        // Reset innych joker贸w gracza w tej rundzie (opcjonalnie)
        if(joker) {
            app.data.schedule[rIdx].matches.forEach(m => {
                if(m.tips[pId]) m.tips[pId].joker = false;
            });
        }

        if(!app.data.schedule[rIdx].matches[mIdx].tips) app.data.schedule[rIdx].matches[mIdx].tips = {};
        app.data.schedule[rIdx].matches[mIdx].tips[pId] = { score, joker };
        
        alert("Zapisano typ. Pamitaj o EKSPORCIE!");
        app.init();
    },

    exportData: function() {
        const json = JSON.stringify(app.data, null, 2);
        const str = `const initialData = ${json};`;
        const area = document.getElementById("exportArea");
        area.value = str;
        area.select();
        document.execCommand("copy");
        alert("Skopiowano kod do schowka! Teraz wklej go do pliku index.html (linia 152).");
    }
};

app.init();
</script>

</body>
</html>


