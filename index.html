<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typer Ekstraliga 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f8; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a237e; margin-bottom: 5px; }
        .sub { text-align: center; color: #666; margin-bottom: 20px; font-size: 0.9em; }
        
        /* Menu */
        .menu { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .btn { padding: 10px 20px; border: none; background: #eee; cursor: pointer; border-radius: 20px; font-weight: bold; }
        .btn.active { background: #1a237e; color: white; }
        .section { display: none; }
        .section.active { display: block; }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; }
        th { background: #eee; padding: 10px; text-align: center; }
        td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }
        .rank-1 { background: #fffde7; border-left: 5px solid #ffab00; }
        .total { font-weight: bold; color: #1a237e; font-size: 1.1em; }
        .team-logo { width: 25px; height: 25px; vertical-align: middle; margin-right: 5px; }

        /* Mecze */
        .match { border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .match-head { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .teams { font-weight: bold; font-size: 1.1em; }
        .res { font-weight: bold; font-size: 1.3em; color: #1a237e; background: #e8eaf6; padding: 5px 10px; border-radius: 5px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        .box { background: #fafafa; padding: 5px; border-radius: 5px; text-align: center; font-size: 0.9em; border: 1px solid #eee; position: relative; }
        .box.win { background: #e8f5e9; border-color: #c8e6c9; }
        .joker { position: absolute; top: -5px; right: -5px; background: #ffab00; font-size: 0.6em; padding: 2px 5px; border-radius: 5px; font-weight: bold; }
        .pts { display: inline-block; width: 18px; height: 18px; line-height: 18px; border-radius: 50%; color: white; font-size: 0.7em; margin-left: 5px; }
        .p5 { background: green; } .p3 { background: #1565c0; } .p2 { background: orange; } .p0 { background: #c62828; }
    </style>
</head>
<body>

<div class="container">
    <h1>üèÅ Typer Ekstraliga 2026</h1>
    <div class="sub">Oficjalna tabela</div>

    <div class="menu">
        <button class="btn active" onclick="ui.tab('rank')">Tabela</button>
        <button class="btn" onclick="ui.tab('matches')">Mecze</button>
        <button class="btn" onclick="ui.tab('chart')">Wykres</button>
    </div>

    <div id="rank" class="section active">
        <table>
            <thead><tr><th>#</th><th style="text-align:left">Gracz</th><th>5pkt</th><th>3pkt</th><th>2pkt</th><th>Suma</th></tr></thead>
            <tbody id="rankBody"></tbody>
        </table>
    </div>

    <div id="matches" class="section">
        <div style="text-align:center; margin-bottom:15px;">
            <select id="roundSel" onchange="ui.renderMatches()" style="padding:10px; width:100%; max-width:300px;"></select>
        </div>
        <div id="matchesList"></div>
    </div>

    <div id="chart" class="section">
        <canvas id="chartCtx"></canvas>
    </div>
</div>

<!-- ≈ÅADOWANIE PLIK√ìW Z DANYMI -->
<script src="mecze.js"></script>
<script src="typy.js"></script>

<!-- LOGIKA -->
<script>
const app = {
    stats: {},
    
    init: function() {
        if(typeof TERMINARZ === 'undefined' || typeof GRACZE === 'undefined') {
            alert("B≈ÅƒÑD: Nie znaleziono plik√≥w mecze.js lub typy.js!");
            return;
        }
        this.calc();
        ui.init();
    },

    getTeamIcon: function(name) {
        const n = name.toLowerCase();
        let url = "";
        if(n.includes("toru≈Ñ")||n.includes("torun")) url="https://v.wpimg.pl/MDc4NzEuYiUCVjhJag5vMEEObBMsV2FmFhZ0WGpBdTxMRygNNVs6NABQIFQ1GWIwAlM9VXNMfCBaBX4fJ0IvfAUGEUl9QH1zWwN_VDUbKmYe";
        else if(n.includes("lublin")) url="https://v.wpimg.pl/MjQ1NDIuYgswUzh3Zg5vHnMLbC0gV2FIJBN0ZmZBdRJ-QigzOVs6GjJVIGo5GWIeMFY9a3xNK1hnAC12fUQrXDIJEXN8RH9eZAV8ajkbKkgs";
        else if(n.includes("wroc≈Çaw")||n.includes("wroclaw")) url="https://v.wpimg.pl/NDQ3NzUuYSUwUThJeg5sMHMJbBM8V2JmJBF0WHpBdjx-QCgNJVs5NDJXIFQlGWEwMFQ9VWNHfXU1BS8ZZ0J6J2UHEU9jR3pwZgR7VCUbKWYs";
        else if(n.includes("grudziƒÖdz")) url="https://v.wpimg.pl/MzI3OTUuYhsoUTlneg5vDmsJbT08V2FYPBF1dnpBdQJmQCkjJVs6CipXIXolGWIOKFQ8e2AQeB57V3tgNkZ1Sn8GEGVhR35Ifgp6eiUbKlg0";
        else if(n.includes("zielona")) url="https://v.wpimg.pl/OTAxMDMuYDUgGjt3Yg5tIGNCby0kV2N2NFp3ZmJBdyxuCyszPVs4JCIcI2o9GWAgIB8-a3tAdmF4TXwhexQrZCVLEnx4TXZkcEh-aj0bKHY8";
        else if(n.includes("czƒôstochowa")) url="https://v.wpimg.pl/NTQ0MzYuYTUwUjtJdg5sIHMKbxMwV2J2JBJ3WHZBdix-QysNKVs5JDJUI1QpGWEgMFc-VWwQezBjUStPa0B4YmcDEk1gR3tgZQN7VCkbKXYs";
        else if(n.includes("gorz√≥w")) url="https://v.wpimg.pl/MDE2OTMuYiUkUDlnYg5vMGcIbT0kV2FmMBB1dmJBdTxqQSkjPVs6NCZWIXo9GWIwJFU8e3gQeCB3UXpseBR-dHYFEGB1RX11cwt8ej0bKmY4";
        else if(n.includes("leszno")) url="https://v.wpimg.pl/OTM2MjAuYDUsUDtZbg5tIG8IbwMoV2N2OBB3SG5BdyxiQSsdMVs4JC5WI0QxGWAgLFU-RXQQejB-A3sPcBd5NikKElp3RXZnewB9RDEbKHYw";
        
        return url ? `<img src="${url}" class="team-logo">` : '';
    },

    parse: function(s) {
        if(!s) return null;
        let p = s.replace('J','').trim().split(':');
        if(p.length < 2) return null;
        return { h: parseInt(p[0]), g: parseInt(p[1]) };
    },

    calc: function() {
        GRACZE.forEach(p => this.stats[p] = { name: p, total: 0, p5:0, p3:0, p2:0, history: [] });
        
        let cumulative = {};
        GRACZE.forEach(p => cumulative[p] = 0);

        TERMINARZ.forEach(round => {
            let roundPts = {};
            GRACZE.forEach(p => roundPts[p] = 0);

            round.mecze.forEach(m => {
                if(m.wynik) {
                    const matchTips = TYPY[m.id] || {};
                    GRACZE.forEach(p => {
                        const tipRaw = matchTips[p];
                        if(tipRaw) {
                            const isJoker = tipRaw.toUpperCase().includes('J');
                            const r = this.parse(m.wynik);
                            const t = this.parse(tipRaw);
                            
                            let pts = 0;
                            if(r && t) {
                                let rd = r.h - r.g;
                                let td = t.h - t.g;
                                let rw = rd > 0 ? 1 : (rd < 0 ? 2 : 0);
                                let tw = td > 0 ? 1 : (td < 0 ? 2 : 0);
                                
                                if(r.h===t.h && r.g===t.g) pts = 5;
                                else if(rw===tw && rd===td) pts = 3;
                                else if(rw===tw) pts = 2;
                            }
                            
                            const finalPts = isJoker ? pts * 2 : pts;
                            this.stats[p].total += finalPts;
                            roundPts[p] += finalPts;

                            if(pts === 5) this.stats[p].p5++;
                            else if(pts === 3) this.stats[p].p3++;
                            else if(pts === 2) this.stats[p].p2++;
                        }
                    });
                }
            });
            GRACZE.forEach(p => {
                cumulative[p] += roundPts[p];
                this.stats[p].history.push(cumulative[p]);
            });
        });
    }
};

const ui = {
    init: function() {
        this.renderRank();
        const sel = document.getElementById("roundSel");
        sel.innerHTML = TERMINARZ.map((r,i) => `<option value="${i}">${r.nazwa}</option>`).join('');
        this.renderMatches();
        this.renderChart();
    },

    tab: function(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    },

    renderRank: function() {
        const tb = document.getElementById("rankBody");
        const sorted = Object.values(app.stats).sort((a,b) => b.total - a.total);
        tb.innerHTML = sorted.map((s,i) => `
            <tr class="${i===0?'rank-1':''}">
                <td>${i+1}.</td>
                <td style="text-align:left; font-weight:bold;">${s.name} ${i===0?'üëë':''}</td>
                <td>${s.p5}</td><td>${s.p3}</td><td>${s.p2}</td>
                <td class="total">${s.total}</td>
            </tr>
        `).join('');
    },

    renderMatches: function() {
        const ridx = document.getElementById("roundSel").value || 0;
        const round = TERMINARZ[ridx];
        const div = document.getElementById("matchesList");
        
        div.innerHTML = round.mecze.map(m => {
            const res = m.wynik ? `<span class="res">${m.wynik}</span>` : `<span style="color:#ccc">--:--</span>`;
            
            const tips = GRACZE.map(p => {
                const matchTips = TYPY[m.id] || {};
                const raw = matchTips[p];
                if(!raw) return '';
                
                const isJoker = raw.toUpperCase().includes('J');
                const cleanScore = raw.replace('J','').trim();
                
                // Kalkulacja do kolork√≥w
                let pts = 0;
                if(m.wynik) {
                    const r = app.parse(m.wynik);
                    const t = app.parse(cleanScore);
                    if(r&&t) {
                        let rd=r.h-r.g, td=t.h-t.g;
                        if(r.h===t.h && r.g===t.g) pts=5;
                        else if((rd>0)===(td>0) && (rd<0)===(td<0) && rd===td) pts=3;
                        else if((rd>0)===(td>0) && (rd<0)===(td<0)) pts=2;
                    }
                }
                const finalPts = isJoker ? pts*2 : pts;
                const winClass = (m.wynik && pts === 5) ? 'win' : '';
                const ptsHtml = m.wynik ? `<span class="pts p${pts}">${finalPts}</span>` : '';
                const jokerHtml = isJoker ? `<span class="joker">JOKER</span>` : '';

                return `<div class="box ${winClass}">
                    <div style="color:#777; font-size:0.8em">${p}</div>
                    <strong>${cleanScore}</strong> ${jokerHtml} ${ptsHtml}
                </div>`;
            }).join('');

            return `<div class="match">
                <div class="match-head">
                    <div>
                        <div style="font-size:0.8em; color:#999">${m.data}</div>
                        <div class="teams">${app.getTeamIcon(m.host)} ${m.host}<br>${app.getTeamIcon(m.guest)} ${m.guest}</div>
                    </div>
                    ${res}
                </div>
                <div class="grid">${tips}</div>
            </div>`;
        }).join('');
    },

    renderChart: function() {
        new Chart(document.getElementById('chartCtx'), {
            type: 'line',
            data: {
                labels: TERMINARZ.map(r => r.nazwa),
                datasets: GRACZE.map((p,i) => ({
                    label: p,
                    data: app.stats[p].history,
                    borderColor: `hsl(${i*50}, 70%, 50%)`,
                    fill: false,
                    tension: 0.1
                }))
            }
        });
    }
};

app.init();
</script>
</body>
</html>
